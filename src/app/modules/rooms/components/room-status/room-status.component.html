<div class="status-management-page">
    <!-- Page Header -->
    <div class="page-header">
      <div class="page-header-content">
        <button class="btn btn-outline-secondary me-3" (click)="goBack()">
          <i class="fas fa-arrow-left"></i>
          Back to Rooms
        </button>
        <div>
          <h1 class="page-title">Room Status Management</h1>
          <p class="page-subtitle">Manage room statuses efficiently</p>
        </div>
      </div>
    </div>
  
    <!-- Statistics Row -->
    <div class="stats-row" *ngIf="statistics">
      <div class="stat-card">
        <div class="stat-icon bg-success">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.available }}</div>
          <div class="stat-label">Available</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon bg-warning">
          <i class="fas fa-user"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.occupied }}</div>
          <div class="stat-label">Occupied</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon bg-info">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.reserved || 0 }}</div>
          <div class="stat-label">Reserved</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon bg-danger">
          <i class="fas fa-tools"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ (statistics.maintenance || 0) + (statistics.outOfOrder || 0) }}</div>
          <div class="stat-label">Maintenance/OOO</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon bg-secondary">
          <i class="fas fa-broom"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ statistics.cleaning || 0 }}</div>
          <div class="stat-label">Cleaning</div>
        </div>
      </div>
    </div>
  
    <!-- Filters Section -->
    <div class="filters-section">
      <div class="row">
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input
              type="text"
              class="form-control"
              placeholder="Search rooms..."
              [(ngModel)]="searchTerm"
              (input)="onFilterChange()"
            />
          </div>
        </div>
        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
            <option *ngFor="let filter of statusFilters" [value]="filter.value">
              {{ filter.label }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="showOnlySelected"
              [(ngModel)]="showOnlySelected"
              (change)="onFilterChange()"
            />
            <label class="form-check-label" for="showOnlySelected">
              Show only selected rooms ({{ selectedRooms.length }})
            </label>
          </div>
        </div>
        <div class="col-md-2">
          <button class="btn btn-outline-secondary w-100" (click)="clearFilters()">
            <i class="fas fa-times"></i>
            Clear
          </button>
        </div>
      </div>
    </div>
  
    <!-- Quick Actions Panel -->
    <div class="quick-actions-panel" *ngIf="selectedRooms.length > 0">
      <div class="panel-header">
        <h5 class="mb-0">
          <i class="fas fa-bolt me-2"></i>
          Quick Status Changes ({{ selectedRooms.length }} room(s) selected)
        </h5>
        <div class="selection-actions">
          <button class="btn btn-sm btn-outline-primary" (click)="selectAllFiltered()">
            Select All Visible
          </button>
          <button class="btn btn-sm btn-outline-secondary" (click)="deselectAll()">
            Deselect All
          </button>
        </div>
      </div>
      
      <div class="status-actions-grid">
        <div 
          class="status-action-card" 
          *ngFor="let action of statusActions"
          (click)="bulkChangeStatus(action.status)"
        >
          <div class="action-icon" [ngClass]="'bg-' + action.color">
            <i [class]="action.icon"></i>
          </div>
          <div class="action-content">
            <h6 class="action-title">{{ action.label }}</h6>
            <p class="action-description">{{ action.description }}</p>
          </div>
          <div class="action-indicator" *ngIf="action.requiresConfirmation">
            <i class="fas fa-exclamation-triangle text-warning"></i>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <div class="d-flex justify-content-center">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
      <p class="mt-3 text-muted text-center">Loading rooms...</p>
    </div>
  
    <!-- Error State -->
    <div class="alert alert-danger" *ngIf="error">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ error }}
      <button class="btn btn-outline-danger btn-sm ms-2" (click)="loadRooms()">
        <i class="fas fa-redo"></i>
        Retry
      </button>
    </div>
  
    <!-- Rooms List -->
    <div class="rooms-list" *ngIf="!loading && !error">
      <div class="list-header">
        <h5>
          Rooms ({{ filteredRooms.length }} of {{ rooms.length }})
        </h5>
      </div>
  
      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredRooms.length === 0">
        <i class="fas fa-search empty-state-icon"></i>
        <h5>No rooms found</h5>
        <p class="text-muted">Try adjusting your filters</p>
      </div>
  
      <!-- Rooms Grid -->
      <div class="rooms-grid" *ngIf="filteredRooms.length > 0">
        <div 
          class="room-status-card" 
          *ngFor="let room of filteredRooms; trackBy: trackByRoomId"
          [class.selected]="isRoomSelected(room.id)"
        >
          <div class="card-header">
            <div class="room-info">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  [id]="'room-' + room.id"
                  [checked]="isRoomSelected(room.id)"
                  (change)="toggleRoomSelection(room.id)"
                />
                <label class="form-check-label" [for]="'room-' + room.id">
                  <strong>Room {{ room.roomNumber }}</strong>
                </label>
              </div>
              <span class="badge" [ngClass]="'badge-' + getStatusClass(room.status)">
                {{ getStatusLabel(room.status) }}
              </span>
            </div>
            <div class="room-actions">
              <button class="btn btn-sm btn-outline-primary" (click)="viewRoom(room.id)">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
  
          <div class="card-body">
            <div class="room-details">
              <div class="detail-item">
                <i class="fas fa-home"></i>
                <span>{{ getRoomTypeLabel(room.roomType) }}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-building"></i>
                <span>{{ room.building }}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-layer-group"></i>
                <span>Floor {{ room.floorNumber }}</span>
              </div>
              <div class="detail-item" *ngIf="room.capacity">
                <i class="fas fa-users"></i>
                <span>{{ room.capacity }} guests</span>
              </div>
            </div>
  
            <div class="current-guest" *ngIf="room.currentGuest">
              <i class="fas fa-user me-2"></i>
              <span>{{ room.currentGuest.name }}</span>
              <small class="d-block text-muted">
                Until: {{ room.currentGuest.checkOut | date:'short' }}
              </small>
            </div>
          </div>
  
          <div class="card-footer">
            <div class="status-change-actions">
              <div class="dropdown">
                <button 
                  class="btn btn-sm btn-primary dropdown-toggle w-100" 
                  type="button" 
                  [id]="'statusDropdown-' + room.id"
                  data-bs-toggle="dropdown" 
                  aria-expanded="false"
                >
                  <i class="fas fa-exchange-alt me-1"></i>
                  Change Status
                </button>
                <ul class="dropdown-menu w-100" [attr.aria-labelledby]="'statusDropdown-' + room.id">
                  <li *ngFor="let action of statusActions">
                    <a 
                      class="dropdown-item"
                      href="javascript:void(0)"
                      (click)="changeRoomStatus(room.id, action.status)"
                      [class.disabled]="room.status === action.status"
                    >
                      <i [class]="action.icon + ' me-2 text-' + action.color"></i>
                      {{ action.label }}
                      <i class="fas fa-exclamation-triangle ms-2 text-warning" 
                         *ngIf="action.requiresConfirmation"
                         title="Requires confirmation"></i>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>